import{M as N}from"./leancloud-service-D8PKWX6z.js";import{S as q}from"./SearchOutline-D1q6xqfW.js";import{d as M,m as P,g as u,n as w,h as U,i as z,b as L,w as l,r as D,o as F,e as n,f as Q,u as o,q as _,s as A,k as B,v as $,x as O,L as V,H as j,_ as H}from"./index-DXhrB1zA.js";const R=M({__name:"Passed",setup(E){const S=P(),i=u(!1),y=async()=>{try{return i.value=!0,(await N.getAllMembers()).filter(a=>a.passDate).map(a=>{const t=new Date(a.passDate),r=Math.floor((new Date().getTime()-t.getTime())/(1e3*60*60*24));return{...a,id:a.objectId,teachingStatus:r>=30?"允许授课":"观察期"}})}catch(e){return console.error("Failed to load data:",e),S.error("加载数据失败"),[]}finally{i.value=!1}},f=u([]),x=w(()=>f.value.map(e=>({...e,teachingStatus:T(e.passDate)}))),T=e=>{const a=new Date(e);return Math.floor((new Date().getTime()-a.getTime())/(1e3*60*60*24))>=30?"允许授课":"观察期"},g=u(""),v=u(null),s=u(null),h=w(()=>{let e=x.value;if(g.value){const a=g.value.toLowerCase();e=e.filter(t=>t.nickname.toLowerCase().includes(a)||t.qq.toLowerCase().includes(a)||t.gameId&&t.gameId.toLowerCase().includes(a))}if(v.value&&(e=e.filter(a=>a.teachingStatus===v.value)),s.value&&s.value[0]&&s.value[1]){const a=new Date(s.value[0]).getTime(),t=new Date(s.value[1]).getTime();e=e.filter(d=>{const r=new Date(d.passDate).getTime();return r>=a&&r<=t})}return e}),c=u({page:1,pageSize:10,itemCount:w(()=>h.value.length),showSizePicker:!0,pageSizes:[10,20,30,40,50,100],prefix:({itemCount:e})=>`共 ${e} 条数据`,suffix:({page:e,pageSize:a,pageCount:t})=>`第 ${e} 页 / 共 ${t} 页`}),k=e=>{c.value.page=e},b=e=>{c.value.pageSize=e;const a=Math.ceil(h.value.length/e);c.value.page>a&&(c.value.page=a)},I=[{title:"昵称",key:"nickname",width:130,sorter:"default"},{title:"QQ号",key:"qq",width:130,sorter:(e,a)=>Number(e.qq)-Number(a.qq)},{title:"游戏ID",key:"gameId",width:130,sorter:"default"},{title:"通过日期",key:"passDate",width:130,sorter:(e,a)=>new Date(e.passDate).getTime()-new Date(a.passDate).getTime()},{title:"授课状态",key:"teachingStatus",width:120,sorter:(e,a)=>{const t={观察期:0,允许授课:1};return t[e.teachingStatus]-t[a.teachingStatus]},render(e){return V(j,{type:e.teachingStatus==="允许授课"?"success":"warning",round:!0},{default:()=>e.teachingStatus})}}];let m=null;const C=()=>{m=window.setInterval(async()=>{f.value=await y()},6e4)};return U(async()=>{try{i.value=!0,f.value=await y()}catch(e){console.error("Failed to load initial data:",e),S.error("初始数据加载失败")}finally{i.value=!1}C()}),z(()=>{m&&clearInterval(m)}),(e,a)=>{const t=D("n-h2"),d=D("n-data-table"),r=D("n-card");return F(),L(r,null,{header:l(()=>[n(t,{style:{margin:"0",color:"#7B1FA2"}},{default:l(()=>a[3]||(a[3]=[Q("通过名单")])),_:1})]),default:l(()=>[n(o(_),{vertical:""},{default:l(()=>[n(o(_),null,{default:l(()=>[n(o(A),{value:g.value,"onUpdate:value":a[0]||(a[0]=p=>g.value=p),placeholder:"搜索昵称/QQ号/游戏ID",clearable:"",style:{width:"200px"}},{prefix:l(()=>[n(o(B),null,{default:l(()=>[n(o(q))]),_:1})]),_:1},8,["value"]),n(o($),{value:v.value,"onUpdate:value":a[1]||(a[1]=p=>v.value=p),placeholder:"授课状态",clearable:"",options:[{label:"允许授课",value:"允许授课"},{label:"观察期",value:"观察期"}],style:{width:"120px"}},null,8,["value"]),n(o(O),{value:s.value,"onUpdate:value":a[2]||(a[2]=p=>s.value=p),type:"daterange",clearable:"",placeholder:"通过日期范围",style:{width:"240px"}},null,8,["value"])]),_:1}),n(d,{columns:I,data:h.value,pagination:c.value,loading:i.value,"onUpdate:page":k,"onUpdate:pageSize":b},null,8,["data","pagination","loading"])]),_:1})]),_:1})}}}),W=H(R,[["__scopeId","data-v-c7d41bcd"]]);export{W as default};
